<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Eingabe - Hexenj√§ger</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .event-form {
            max-width: 1000px;
            margin: 0 auto;
        }

        .form-section {
            margin-bottom: var(--space-xl);
            padding: var(--space-lg);
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
        }

        .form-section h3 {
            color: var(--accent-purple-light);
            margin-bottom: var(--space-lg);
            font-size: 1.2em;
        }

        .members-selection {
            margin-top: var(--space-md);
        }

        .selected-count {
            color: var(--accent-purple-light);
            font-weight: 600;
            margin-bottom: var(--space-md);
            padding: var(--space-sm) var(--space-md);
            background: rgba(99, 102, 241, 0.1);
            border-radius: var(--radius-md);
            display: inline-block;
        }

        .quick-actions {
            margin-bottom: var(--space-lg);
        }

        .preview-box {
            background: var(--bg-darker);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            margin-top: var(--space-lg);
        }

        .preview-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-md) 0;
            border-bottom: 1px solid var(--border-color);
        }

        .preview-item:last-child {
            border-bottom: none;
        }

        .event-details {
            display: none;
            background: var(--bg-darker);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            margin-top: var(--space-md);
        }

        .individual-inputs {
            margin-top: var(--space-md);
        }

        .member-input {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            padding: var(--space-md);
            background: var(--bg-card);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-sm);
            border: 1px solid var(--border-color);
        }

        .member-input label {
            min-width: 120px;
            color: var(--text-light);
            font-weight: 500;
        }

        .member-input input {
            width: 100px;
            padding: var(--space-sm);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            background: var(--bg-darker);
            color: var(--text-light);
            text-align: center;
        }

        .event-prices-container {
            margin-top: var(--space-xl);
            padding-top: var(--space-lg);
            border-top: 1px solid var(--border-color);
        }

        .event-prices-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--space-md);
            margin-top: var(--space-lg);
        }

        .event-price-item {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: var(--space-md);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
        }

        .event-price-item:hover {
            border-color: var(--accent-purple);
        }

        .event-price-info {
            flex: 1;
        }

        .event-price-name {
            font-weight: 600;
            color: var(--text-light);
            margin-bottom: var(--space-xs);
        }

        .event-price-description {
            color: var(--text-muted);
            font-size: 0.85em;
        }

        .event-price-input {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .event-price-input input {
            width: 120px;
            padding: var(--space-sm);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            background: var(--bg-darker);
            color: var(--text-light);
            text-align: right;
        }

        .price-unit {
            color: var(--text-muted);
            font-size: 0.9em;
            min-width: 60px;
        }

        .form-actions {
            display: flex;
            gap: var(--space-md);
            margin-top: var(--space-xl);
        }

        .form-actions .btn {
            flex: 1;
        }

        .event-type-info {
            margin-top: var(--space-sm);
            color: var(--text-muted);
            font-size: 0.9em;
            padding: var(--space-sm);
            background: rgba(99, 102, 241, 0.05);
            border-radius: var(--radius-md);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="hexenjaeger-symbol"></div>
            <h1>Event Eingabe</h1>
            <p>Schnelle Erfassung f√ºr mehrere Mitglieder</p>
            <a href="index.html" class="back-btn">‚Üê Zur√ºck zur √úbersicht</a>
        </header>

        <div class="card">
            <h2>Neues Event erfassen</h2>
            
            <div class="event-form">
                <!-- Event Typ Auswahl -->
                <div class="form-section">
                    <h3>Event Typ</h3>
                    <div class="form-group">
                        <label for="eventType">Event ausw√§hlen</label>
                        <select id="eventType">
                            <option value="">-- Bitte Event ausw√§hlen --</option>
                            <option value="bizwar_win">‚öîÔ∏è Bizwar Win</option>
                            <option value="bizwar_lose">‚öîÔ∏è Bizwar Lose</option>
                            <option value="40er_win">üî´ 40er Win</option>
                            <option value="40er_lose">üî´ 40er Lose</option>
                            <option value="ekz">üéØ EKZ</option>
                            <option value="hafen">‚öì Hafen</option>
                            <option value="giesserei">üè≠ Gie√üerei</option>
                            <option value="waffenfabrik">üî´ Waffenfabrik</option>
                            <option value="cayo">üèùÔ∏è Cayo Perico</option>
                            <option value="rp_fabrik">üè≠ RP Fabrik</option>
                        </select>
                        <div class="event-type-info" id="eventTypeInfo">
                            W√§hle einen Event-Typ um fortzufahren
                        </div>
                    </div>
                </div>

                <!-- Mitglieder Auswahl -->
                <div class="form-section">
                    <h3>Mitglieder Auswahl</h3>
                    <div class="quick-actions">
                        <button type="button" class="quick-btn" onclick="selectAllMembers()">‚úÖ Alle ausw√§hlen</button>
                        <button type="button" class="quick-btn" onclick="deselectAllMembers()">‚ùå Alle abw√§hlen</button>
                    </div>
                    <div class="selected-count" id="selectedCount">0 Mitglieder ausgew√§hlt</div>
                    <div class="members-grid" id="membersGrid">
                        <!-- Wird via JavaScript gef√ºllt -->
                    </div>
                </div>

                <!-- Event Details -->
                <div id="eventDetails" class="event-details">
                    <h3>Event Details</h3>
                    
                    <!-- Gemeinsame Eingabe f√ºr Cayo, RP Fabrik -->
                    <div id="sharedAmount" style="display: none;">
                        <div class="form-group">
                            <label for="sharedAmountInput" id="sharedAmountLabel">Anzahl</label>
                            <input type="number" id="sharedAmountInput" min="1" value="1">
                        </div>
                        <div class="form-group">
                            <label for="sharedTotalAmount">Gesamtbetrag ($)</label>
                            <input type="number" id="sharedTotalAmount" min="1" placeholder="Gesamtbetrag eingeben">
                        </div>
                    </div>

                    <!-- Individuelle Eingabe f√ºr Kills/Drops/Wins -->
                    <div id="individualAmounts" style="display: none;">
                        <div class="form-group">
                            <label id="individualAmountLabel">Anzahl pro Mitglied</label>
                        </div>
                        <div class="individual-inputs" id="individualInputsContainer">
                            <!-- Wird via JavaScript gef√ºllt -->
                        </div>
                    </div>
                </div>

                <!-- Vorschau -->
                <div id="previewSection" class="preview-box" style="display: none;">
                    <h3 style="margin-bottom: var(--space-md); color: var(--accent-purple-light);">üìä Vorschau</h3>
                    <div id="previewContent"></div>
                </div>

                <!-- Aktionen -->
                <div class="form-actions">
                    <button id="submitEvent" class="btn btn-primary">üíæ Event speichern</button>
                    <button type="button" onclick="resetForm()" class="btn btn-secondary">üîÑ Zur√ºcksetzen</button>
                </div>
                
                <div id="statusMessage" style="margin-top: var(--space-md); text-align: center; display: none;"></div>
            </div>

            <!-- Event-Preise Container -->
            <div class="event-prices-container">
                <h3>Event-Preise verwalten</h3>
                <p>Aktuelle Auszahlungsbetr√§ge pro Event-Typ</p>
                
                <div class="event-prices-grid" id="eventPricesGrid">
                    <!-- Wird via JavaScript gef√ºllt -->
                </div>
                
                <div class="form-actions">
                    <button onclick="saveEventPrices()" class="btn btn-primary">üíæ Preise speichern</button>
                    <button onclick="resetEventPrices()" class="btn btn-secondary">üîÑ Standard-Preise</button>
                </div>
                
                <div id="pricesStatusMessage" style="margin-top: var(--space-md); text-align: center; display: none;"></div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        let selectedMembers = [];

        // Event-Preis Konfiguration
        const defaultEventPrices = {
            'bizwar_win': { price: 50000, description: 'Pro Kill (Win)', unit: 'pro Kill' },
            'bizwar_lose': { price: 25000, description: 'Pro Kill (Lose)', unit: 'pro Kill' },
            '40er_win': { price: 40000, description: 'Pro Kill (Win)', unit: 'pro Kill' },
            '40er_lose': { price: 20000, description: 'Pro Kill (Lose)', unit: 'pro Kill' },
            'giesserei': { price: 30000, description: 'Pro Kill', unit: 'pro Kill' },
            'waffenfabrik': { price: 35000, description: 'Pro Kill', unit: 'pro Kill' },
            'hafen': { price: 100000, description: 'Pro Drop', unit: 'pro Drop' },
            'ekz': { price: 150000, description: 'Pro Win', unit: 'pro Win' }
        };

        // Event-Typ Informationen
        const eventTypeInfo = {
            'bizwar_win': 'Kills bei gewonnenem Bizwar - Preis pro Kill',
            'bizwar_lose': 'Kills bei verlorenem Bizwar - Preis pro Kill',
            '40er_win': 'Kills bei gewonnenem 40er - Preis pro Kill',
            '40er_lose': 'Kills bei verlorenem 40er - Preis pro Kill',
            'giesserei': 'Kills in der Gie√üerei - Preis pro Kill',
            'waffenfabrik': 'Kills in der Waffenfabrik - Preis pro Kill',
            'hafen': 'Drops im Hafen - Preis pro Drop',
            'ekz': 'Gewonnene EKZs - Preis pro Win',
            'cayo': 'Cayo Perico Drops - Gesamtbetrag wird aufgeteilt',
            'rp_fabrik': 'RP Fabrik Wins - Gesamtbetrag wird aufgeteilt'
        };

        // Mitglieder laden und anzeigen
        function loadMembers() {
            const membersGrid = document.getElementById('membersGrid');
            const members = db.getMembers();
            
            membersGrid.innerHTML = members.map(member => `
                <div class="member-tag" data-id="${member.id}" data-name="${member.name}">
                    <input type="checkbox" id="member_${member.id}" style="display: none;">
                    <span>${member.name}</span>
                    <small style="color: var(--text-muted);">(${member.id})</small>
                </div>
            `).join('');

            // Event Listener f√ºr Member Tags
            membersGrid.querySelectorAll('.member-tag').forEach(tag => {
                tag.addEventListener('click', function() {
                    const memberId = this.dataset.id;
                    const checkbox = this.querySelector('input');
                    
                    if (checkbox.checked) {
                        // Abw√§hlen
                        checkbox.checked = false;
                        this.classList.remove('selected');
                        selectedMembers = selectedMembers.filter(id => id !== memberId);
                    } else {
                        // Ausw√§hlen
                        checkbox.checked = true;
                        this.classList.add('selected');
                        selectedMembers.push(memberId);
                    }
                    
                    updateSelectedCount();
                    updateIndividualInputs();
                    updatePreview();
                });
            });
        }

        function updateSelectedCount() {
            const count = selectedMembers.length;
            document.getElementById('selectedCount').textContent = `${count} Mitglieder ausgew√§hlt`;
        }

        function selectAllMembers() {
            const members = db.getMembers();
            selectedMembers = members.map(m => m.id);
            
            document.querySelectorAll('.member-tag').forEach(tag => {
                tag.classList.add('selected');
                tag.querySelector('input').checked = true;
            });
            
            updateSelectedCount();
            updateIndividualInputs();
            updatePreview();
        }

        function deselectAllMembers() {
            selectedMembers = [];
            document.querySelectorAll('.member-tag').forEach(tag => {
                tag.classList.remove('selected');
                tag.querySelector('input').checked = false;
            });
            updateSelectedCount();
            updateIndividualInputs();
            updatePreview();
        }

        function updateIndividualInputs() {
            const container = document.getElementById('individualInputsContainer');
            container.innerHTML = '';
            
            selectedMembers.forEach(memberId => {
                const member = db.getMembers().find(m => m.id === memberId);
                if (member) {
                    const inputHtml = `
                        <div class="member-input">
                            <label>${member.name}:</label>
                            <input type="number" id="amount_${memberId}" min="1" value="1" oninput="updatePreview()">
                        </div>
                    `;
                    container.innerHTML += inputHtml;
                }
            });
            updatePreview();
        }

        function updatePreview() {
            const previewSection = document.getElementById('previewSection');
            const previewContent = document.getElementById('previewContent');
            const eventType = document.getElementById('eventType');
            
            if (!eventType.value || selectedMembers.length === 0) {
                previewSection.style.display = 'none';
                return;
            }

            const eventTypeValue = eventType.value;
            let totalPayout = 0;
            let description = '';

            // Shared Events (Cayo, RP Fabrik)
            if (['cayo', 'rp_fabrik'].includes(eventTypeValue)) {
                const amount = parseInt(document.getElementById('sharedAmountInput').value) || 1;
                const totalAmount = parseInt(document.getElementById('sharedTotalAmount').value) || 0;
                
                if (totalAmount > 0) {
                    const perMember = Math.round(totalAmount / selectedMembers.length);
                    totalPayout = totalAmount;
                    
                    const eventNames = {
                        'cayo': 'Cayo Perico',
                        'rp_fabrik': 'RP Fabrik'
                    };
                    
                    const unit = eventTypeValue === 'cayo' ? 'Drops' : 'Wins';
                    description = `${eventNames[eventTypeValue]} - ${amount} ${unit}`;
                    
                    previewContent.innerHTML = `
                        <div class="preview-item">
                            <span>${selectedMembers.length} Mitglieder</span>
                            <span>${formatCurrency(perMember)} pro Person</span>
                        </div>
                        <div class="preview-item">
                            <span>Gesamtbetrag</span>
                            <span><strong>${formatCurrency(totalPayout)}</strong></span>
                        </div>
                    `;
                }
            } 
            // Individuelle Events (Bizwar, 40er, Hafen, Gie√üerei, Waffenfabrik, EKZ)
            else {
                let individualAmounts = [];
                selectedMembers.forEach(memberId => {
                    const amount = parseInt(document.getElementById(`amount_${memberId}`)?.value) || 1;
                    const eventPrice = db.getEventPrice(eventTypeValue, amount);
                    individualAmounts.push({
                        memberId: memberId,
                        amount: amount,
                        amountValue: eventPrice
                    });
                    totalPayout += eventPrice;
                });

                const eventNames = {
                    'bizwar_win': 'Bizwar Win', 'bizwar_lose': 'Bizwar Lose',
                    '40er_win': '40er Win', '40er_lose': '40er Lose',
                    'hafen': 'Hafen', 'giesserei': 'Gie√üerei', 
                    'waffenfabrik': 'Waffenfabrik', 'ekz': 'EKZ'
                };
                
                description = eventNames[eventTypeValue];
                
                previewContent.innerHTML = individualAmounts.map(item => {
                    const member = db.getMembers().find(m => m.id === item.memberId);
                    let unit = 'Kills';
                    if (eventTypeValue.includes('hafen')) unit = 'Drops';
                    if (eventTypeValue === 'ekz') unit = 'Wins';
                    
                    return `
                        <div class="preview-item">
                            <span>${member.name} (${item.amount} ${unit})</span>
                            <span>${formatCurrency(item.amountValue)}</span>
                        </div>
                    `;
                }).join('') + `
                    <div class="preview-item" style="border-top: 2px solid var(--accent-purple); font-weight: bold; margin-top: var(--space-md);">
                        <span>Gesamt (${selectedMembers.length} Mitglieder)</span>
                        <span>${formatCurrency(totalPayout)}</span>
                    </div>
                `;
            }

            if (totalPayout > 0) {
                previewSection.style.display = 'block';
            } else {
                previewSection.style.display = 'none';
            }
        }

        function resetForm() {
            document.getElementById('eventType').value = '';
            selectedMembers = [];
            document.querySelectorAll('.member-tag').forEach(tag => {
                tag.classList.remove('selected');
                tag.querySelector('input').checked = false;
            });
            document.getElementById('sharedAmountInput').value = '1';
            document.getElementById('sharedTotalAmount').value = '';
            document.getElementById('eventDetails').style.display = 'none';
            document.getElementById('previewSection').style.display = 'none';
            document.getElementById('eventTypeInfo').textContent = 'W√§hle einen Event-Typ um fortzufahren';
            updateSelectedCount();
        }

        // Event-Preis Management
        function loadEventPrices() {
            let eventPrices = db.getEventPrices();
            
            if (Object.keys(eventPrices).length === 0) {
                eventPrices = defaultEventPrices;
                db.saveEventPrices(eventPrices);
            }
            
            const grid = document.getElementById('eventPricesGrid');
            
            const eventNames = {
                'bizwar_win': '‚öîÔ∏è Bizwar Win',
                'bizwar_lose': '‚öîÔ∏è Bizwar Lose',
                '40er_win': 'üî´ 40er Win',
                '40er_lose': 'üî´ 40er Lose',
                'giesserei': 'üè≠ Gie√üerei',
                'waffenfabrik': 'üî´ Waffenfabrik',
                'hafen': '‚öì Hafen',
                'ekz': 'üéØ EKZ'
            };
            
            grid.innerHTML = Object.entries(eventPrices)
                .filter(([eventType]) => eventType in eventNames)
                .map(([eventType, config]) => `
                <div class="event-price-item">
                    <div class="event-price-info">
                        <div class="event-price-name">${eventNames[eventType]}</div>
                        <div class="event-price-description">${config.description}</div>
                    </div>
                    <div class="event-price-input">
                        <input type="number" id="price_${eventType}" value="${config.price}" min="0" step="1000">
                        <span class="price-unit">${config.unit}</span>
                    </div>
                </div>
            `).join('');

            // Hinweis f√ºr variable Preise
            grid.innerHTML += `
                <div class="event-price-item" style="grid-column: 1 / -1; background: var(--bg-darker);">
                    <div class="event-price-info">
                        <div class="event-price-name">üèùÔ∏è Cayo Perico & üè≠ RP Fabrik</div>
                        <div class="event-price-description">Preise werden pro Event individuell festgelegt</div>
                    </div>
                    <div class="event-price-input">
                        <span class="price-unit" style="color: var(--text-muted);">Variable Preise</span>
                    </div>
                </div>
            `;
        }

        function saveEventPrices() {
            const eventPrices = {};
            const eventTypes = Object.keys(defaultEventPrices);
            
            eventTypes.forEach(eventType => {
                const input = document.getElementById(`price_${eventType}`);
                if (input) {
                    const price = parseInt(input.value) || 0;
                    eventPrices[eventType] = {
                        price: price,
                        description: defaultEventPrices[eventType].description,
                        unit: defaultEventPrices[eventType].unit
                    };
                }
            });
            
            db.saveEventPrices(eventPrices);
            showPricesStatus('‚úÖ Event-Preise erfolgreich gespeichert!', 'success');
        }

        function resetEventPrices() {
            db.saveEventPrices(defaultEventPrices);
            loadEventPrices();
            showPricesStatus('‚úÖ Standard-Preise wiederhergestellt!', 'success');
        }

        function showPricesStatus(message, type) {
            const statusElement = document.getElementById('pricesStatusMessage');
            statusElement.textContent = message;
            statusElement.style.color = type === 'success' ? 'var(--success)' : 'var(--error)';
            statusElement.style.display = 'block';
            setTimeout(() => statusElement.style.display = 'none', 4000);
        }

        function showStatus(message, type) {
            const statusElement = document.getElementById('statusMessage');
            statusElement.textContent = message;
            statusElement.style.color = type === 'success' ? 'var(--success)' : 'var(--error)';
            statusElement.style.display = 'block';
            setTimeout(() => statusElement.style.display = 'none', 4000);
        }

        // Initialisierung
        document.addEventListener('DOMContentLoaded', function() {
            const eventType = document.getElementById('eventType');
            const submitBtn = document.getElementById('submitEvent');

            // Lade Mitglieder und Preise
            loadMembers();
            loadEventPrices();

            // Event Type Change Handler
            eventType.addEventListener('change', function() {
                const sharedAmount = document.getElementById('sharedAmount');
                const individualAmounts = document.getElementById('individualAmounts');
                const sharedAmountLabel = document.getElementById('sharedAmountLabel');
                const individualAmountLabel = document.getElementById('individualAmountLabel');
                const eventDetails = document.getElementById('eventDetails');
                const eventTypeInfoElement = document.getElementById('eventTypeInfo');
                
                if (this.value) {
                    eventDetails.style.display = 'block';
                    eventTypeInfoElement.textContent = eventTypeInfo[this.value] || '';
                    
                    // Konfiguriere Labels basierend auf Event-Typ
                    const eventConfig = {
                        'bizwar_win': { shared: false, label: 'Kills pro Mitglied' },
                        'bizwar_lose': { shared: false, label: 'Kills pro Mitglied' },
                        '40er_win': { shared: false, label: 'Kills pro Mitglied' },
                        '40er_lose': { shared: false, label: 'Kills pro Mitglied' },
                        'ekz': { shared: false, label: 'Wins pro Mitglied' },
                        'hafen': { shared: false, label: 'Drops pro Mitglied' },
                        'giesserei': { shared: false, label: 'Kills pro Mitglied' },
                        'waffenfabrik': { shared: false, label: 'Kills pro Mitglied' },
                        'cayo': { shared: true, label: 'Drops' },
                        'rp_fabrik': { shared: true, label: 'Wins' }
                    };

                    const config = eventConfig[this.value];
                    
                    if (config.shared) {
                        sharedAmount.style.display = 'block';
                        individualAmounts.style.display = 'none';
                        sharedAmountLabel.textContent = config.label;
                    } else {
                        sharedAmount.style.display = 'none';
                        individualAmounts.style.display = 'block';
                        individualAmountLabel.textContent = config.label;
                        updateIndividualInputs();
                    }
                } else {
                    eventDetails.style.display = 'none';
                    eventTypeInfoElement.textContent = 'W√§hle einen Event-Typ um fortzufahren';
                }
                
                updatePreview();
            });

            // Input Listener f√ºr Live-Vorschau
            document.getElementById('sharedAmountInput')?.addEventListener('input', updatePreview);
            document.getElementById('sharedTotalAmount')?.addEventListener('input', updatePreview);

            // Event speichern
            submitBtn.addEventListener('click', function() {
                if (!eventType.value) {
                    showStatus('‚ùå Bitte Event-Typ ausw√§hlen', 'error');
                    return;
                }

                if (selectedMembers.length === 0) {
                    showStatus('‚ùå Bitte Mitglieder ausw√§hlen', 'error');
                    return;
                }

                const eventTypeValue = eventType.value;
                let eventData = {};

                // Shared Events (Cayo, RP Fabrik)
                if (['cayo', 'rp_fabrik'].includes(eventTypeValue)) {
                    const amount = parseInt(document.getElementById('sharedAmountInput').value) || 1;
                    const totalAmount = parseInt(document.getElementById('sharedTotalAmount').value) || 0;

                    if (totalAmount === 0) {
                        showStatus('‚ùå Bitte Gesamtbetrag eingeben', 'error');
                        return;
                    }

                    eventData = {
                        eventType: eventTypeValue,
                        memberIds: selectedMembers,
                        amount: amount,
                        totalAmount: totalAmount
                    };

                    const result = db.addEvent(eventData);
                    if (result.success) {
                        showStatus(`‚úÖ Event f√ºr ${selectedMembers.length} Mitglieder gespeichert! Gesamt: ${formatCurrency(result.calculatedAmount)}`, 'success');
                        resetForm();
                    } else {
                        showStatus('‚ùå Fehler: ' + result.error, 'error');
                    }
                } 
                // Individuelle Events (Bizwar, 40er, Hafen, Gie√üerei, Waffenfabrik, EKZ)
                else {
                    let successCount = 0;
                    let totalCalculated = 0;

                    selectedMembers.forEach(memberId => {
                        const amount = parseInt(document.getElementById(`amount_${memberId}`).value) || 1;
                        
                        const singleEventData = {
                            eventType: eventTypeValue,
                            memberIds: [memberId],
                            amount: amount,
                            totalAmount: 0
                        };

                        const result = db.addEvent(singleEventData);
                        if (result.success) {
                            successCount++;
                            totalCalculated += result.calculatedAmount;
                        }
                    });

                    if (successCount === selectedMembers.length) {
                        showStatus(`‚úÖ Event f√ºr ${successCount} Mitglieder gespeichert! Gesamt: ${formatCurrency(totalCalculated)}`, 'success');
                        resetForm();
                    } else {
                        showStatus(`‚ö†Ô∏è Event f√ºr ${successCount}/${selectedMembers.length} Mitgliedern gespeichert`, 'warning');
                    }
                }
            });
        });
    </script>
</body>
</html>
