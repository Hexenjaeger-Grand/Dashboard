<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HexenjÃ¤ger Dashboard</title>
  <style>
    :root {
      --bg: #0f172a; --text: #e5e7eb; --muted: #9ca3af; 
      --border: #1f2937; --accent: #7c3aed; --accent2: #06b6d4;
      --card: rgba(255,255,255,0.05);
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui;padding:24px 16px;}
    .wrap{max-width:1200px;margin:0 auto}
    
    /* Header */
    .header{text-align:center;margin-bottom:32px}
    h1{font-size:clamp(28px,5vw,42px);margin:0;background:linear-gradient(90deg,var(--accent),var(--accent2));-webkit-background-clip:text;background-clip:text;color:transparent}
    .subtitle{color:var(--muted);margin-top:8px}
    
    /* Navigation */
    .nav{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin:24px 0}
    .nav a{padding:12px 20px;background:var(--card);border:1px solid var(--border);border-radius:12px;text-decoration:none;color:var(--text);transition:all 0.2s}
    .nav a:hover{background:var(--accent);transform:translateY(-2px)}
    
    /* Stats Grid */
    .stats-grid{display:grid;grid-template-columns:repeat(auto-fit, minmax(250px, 1fr));gap:16px;margin:24px 0}
    .stat-card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:20px;text-align:center}
    .stat-number{font-size:32px;font-weight:800;background:linear-gradient(90deg,var(--accent),var(--accent2));-webkit-background-clip:text;background-clip:text;color:transparent}
    .stat-label{color:var(--muted);margin-top:8px}
    
    /* AktivitÃ¤ten */
    .activity-card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:20px;margin-top:24px}
    table{width:100%;border-collapse:collapse}
    th,td{padding:12px;text-align:left;border-bottom:1px solid var(--border)}
    th{color:var(--muted);font-weight:600;font-size:14px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <h1>HexenjÃ¤ger Dashboard</h1>
      <p class="subtitle">Familien Management System</p>
    </div>

    <!-- Navigation -->
    <div class="nav">
      <a href="auszahlung.html">ðŸ’° Auszahlungen</a>
      <a href="statistik.html">ðŸ“Š Statistik</a>
      <a href="events.html" id="eventsTab">ðŸ“… Events</a>
      <a href="mitglieder.html" id="membersTab">ðŸ‘¥ Mitglieder</a>
      <a href="#" id="loginBtn">ðŸ”‘ Login</a>
      <a href="#" id="logoutBtn" style="display:none">ðŸšª Logout</a>
    </div>

    <!-- Stats Overview -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-number" id="totalPayouts">0 $</div>
        <div class="stat-label">Gesamte Auszahlungen</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="openPayouts">0 $</div>
        <div class="stat-label">Offene Auszahlungen</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="activeMembers">0</div>
        <div class="stat-label">Aktive Mitglieder</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="totalEvents">0</div>
        <div class="stat-label">Events diesen Monat</div>
      </div>
    </div>

    <!-- Letzte AktivitÃ¤ten -->
    <div class="activity-card">
      <h3>ðŸ“ˆ Letzte AktivitÃ¤ten</h3>
      <table>
        <thead>
          <tr><th>Datum</th><th>Mitglied</th><th>Event</th><th>Betrag</th></tr>
        </thead>
        <tbody id="recentActivities"></tbody>
      </table>
    </div>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCB909WgDGPh1KE6lMpZshQ1BmzoTYR2Ic",
      authDomain: "hexenjaeger-dashboard.firebaseapp.com",
      projectId: "hexenjaeger-dashboard",
      storageBucket: "hexenjaeger-dashboard.firebasestorage.app",
      messagingSenderId: "48507598074",
      appId: "1:48507598074:web:d736c118fd74d1968d0543"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // Login System
    document.getElementById('loginBtn').onclick = () => {
      const email = prompt('Admin Email:');
      const password = prompt('Passwort:');
      if (email && password) {
        auth.signInWithEmailAndPassword(email, password).catch(error => {
          alert('Login fehlgeschlagen: ' + error.message);
        });
      }
    };

    document.getElementById('logoutBtn').onclick = () => auth.signOut();

    auth.onAuthStateChanged(user => {
      const isLeader = !!user;
      document.getElementById('loginBtn').style.display = isLeader ? 'none' : 'block';
      document.getElementById('logoutBtn').style.display = isLeader ? 'block' : 'none';
      document.getElementById('eventsTab').style.display = isLeader ? 'block' : 'none';
      document.getElementById('membersTab').style.display = isLeader ? 'block' : 'none';
    });

    // Daten laden
    function loadDashboardData() {
      // Mitglieder zÃ¤hlen
      db.collection('members').onSnapshot(snap => {
        document.getElementById('activeMembers').textContent = snap.size;
      });

      // Transaktionen fÃ¼r Stats
      db.collection('transactions').onSnapshot(snap => {
        let totalPayouts = 0;
        let openPayouts = 0;
        const recent = [];

        snap.forEach(doc => {
          const t = doc.data();
          if (t.type === 'auszahlung') {
            totalPayouts += t.amount || 0;
            if (!t.paid) openPayouts += t.amount || 0;
          }
          
          // Letzte 5 AktivitÃ¤ten
          if (recent.length < 5) {
            recent.push(t);
          }
        });

        document.getElementById('totalPayouts').textContent = totalPayouts.toLocaleString('de-DE') + ' $';
        document.getElementById('openPayouts').textContent = openPayouts.toLocaleString('de-DE') + ' $';
        
        // AktivitÃ¤ten anzeigen
        const activitiesTbody = document.getElementById('recentActivities');
        activitiesTbody.innerHTML = recent.map(t => `
          <tr>
            <td>${new Date(t.timestamp).toLocaleDateString('de-DE')}</td>
            <td>${t.memberName}</td>
            <td>${t.eventType}</td>
            <td>${(t.amount || 0).toLocaleString('de-DE')} $</td>
          </tr>
        `).join('');
      });

      // Events zÃ¤hlen (diesen Monat)
      const thisMonth = new Date().getMonth();
      db.collection('events').where('timestamp', '>=', new Date(new Date().getFullYear(), thisMonth, 1))
        .onSnapshot(snap => {
          document.getElementById('totalEvents').textContent = snap.size;
        });
    }

    loadDashboardData();
  </script>
</body>
</html>
